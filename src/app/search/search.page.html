<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>search</ion-title>
    <ion-button slot="end" (click)="clearAll()">Clear all</ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-item>
    <ion-label>Rating Range</ion-label>
    <ion-range
      dualKnobs="true"
      min="0"
      max="5"
      step="0.25"
      [(ngModel)]="ratingRange"
      (ionChange)="onRangeChange($event)"
    >
      <ion-label slot="start">Min</ion-label>
      <ion-label slot="end">Max</ion-label>
    </ion-range>
  </ion-item>
  <ion-item>
    <ion-label>Min Rating: {{ ratingRange.lower }}</ion-label>
    <ion-label>Max Rating: {{ ratingRange.upper }}</ion-label>
  </ion-item>

  <form [formGroup]="filterForm" (ngSubmit)="applyFilter()">
    <ion-item>
      <ion-segment formControlName="isRead">
        <ion-segment-button value="Read">Read</ion-segment-button>
        <ion-segment-button value="Unread">Unread</ion-segment-button>
      </ion-segment>
    </ion-item>

    <ion-item>
      <ion-label>Select Topic</ion-label>

      <ion-select
        formControlName="topics"
        multiple="true"
        placeholder="Select topics"
      >
        <ion-select-option *ngFor="let topic of getAllTopics()"
          >{{ topic }}</ion-select-option
        >
      </ion-select>
    </ion-item>

    <ion-button expand="full" type="submit">Apply Filter</ion-button>
  </form>

  <ion-list>
    <ion-searchbar
      (ionInput)="Search()"
      [(ngModel)]="searchitem"
      showCancelButton="never"
    ></ion-searchbar>
    <ion-card *ngFor="let post of filteredPosts; let i = index" #card>
      <ion-card-header (click)="goToDetails(post.id)">
        <ion-card-title>{{ post.title }}</ion-card-title>
        <ion-row>
          <ion-col>
            <ion-card-subtitle
              >{{ post.type }} by {{ getUsernameById(post.authorId)
              }}</ion-card-subtitle
            >
          </ion-col>
          <ion-item lines="none">
            <ion-icon name="heart"></ion-icon>
            <span>{{ post.likedBy.length }} Likes</span>
            <ion-icon
              name="star"
              *ngFor="let star of [1, 2, 3, 4, 5]"
              [color]="star <= calculateRatingsAvg(post.ratings) ? 'primary' : 'medium'"
            ></ion-icon>
          </ion-item>
        </ion-row>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="12">
              <img [src]="post.detailsArray[0].images[0]" alt="Post Image" />
            </ion-col>
            <ion-col size="12">
              <ion-text>{{ post.detailsArray[0].summary }}</ion-text>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <p class="topics">
                <ng-container *ngFor="let topic of post.topics; let i = index">
                  {{ i !== 0 ? ' ' : '' }} #{{ topic }}
                </ng-container>
              </p>
            </ion-col>
            <ion-col>{{ convertFirebaseDate(post.date) }}</ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>
  </ion-list>
</ion-content>
